{% extends 'base_ozon.html' %}
{% load static %}
{% load i18n %}

{% block title %}Вход - ShopList{% endblock %}

{% block content %}
{% include 'components/auth_base.html' with 
    title="Войти в аккаунт" 
    subtitle="Войдите, чтобы продолжить покупки"
    show_social_auth=True
    submit_text="Войти"
    divider_text="Нет аккаунта?"
%}

{% block form_content %}
<!-- Переключатель способов входа -->
<div class="mb-6">
    <div class="flex space-x-1 bg-gray-100 p-1 rounded-lg">
        <button type="button" 
                id="phoneTab" 
                class="flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors bg-white text-blue-600 shadow-sm">
            <i class="fas fa-mobile-alt mr-2"></i>Телефон
        </button>
        <button type="button" 
                id="emailTab" 
                class="flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors text-gray-500 hover:text-gray-700">
            <i class="fas fa-envelope mr-2"></i>Email
        </button>
    </div>
</div>

<!-- Вход по телефону -->
<div id="phoneLogin" class="login-method">
    {% include 'components/phone_input.html' %}
</div>

<!-- Вход по email -->
<div id="emailLogin" class="login-method hidden">
    <div class="space-y-4">
        <div>
            <label for="email" class="block text-sm font-medium text-gray-700">
                Email адрес
            </label>
            <input type="email" 
                   id="email" 
                   name="email" 
                   class="mt-1 block w-full px-3 py-3 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" 
                   placeholder="example@email.com"
                   required>
        </div>
        
        <div>
            <label for="password" class="block text-sm font-medium text-gray-700">
                Пароль
            </label>
            <div class="mt-1 relative">
                <input type="password" 
                       id="password" 
                       name="password" 
                       class="block w-full px-3 py-3 pr-10 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" 
                       placeholder="Введите пароль"
                       required>
                <button type="button" 
                        class="absolute inset-y-0 right-0 pr-3 flex items-center"
                        onclick="togglePassword('password')">
                    <i class="fas fa-eye text-gray-400 hover:text-gray-600"></i>
                </button>
            </div>
        </div>
        
        <!-- Запомнить меня и забыли пароль -->
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                <input id="remember_me" 
                       name="remember_me" 
                       type="checkbox" 
                       class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                <label for="remember_me" class="ml-2 block text-sm text-gray-700">
                    Запомнить меня
                </label>
            </div>
            
            <div class="text-sm">
                <a href="{% url 'password_reset' %}" class="font-medium text-blue-600 hover:text-blue-500">
                    Забыли пароль?
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Скрытые поля для определения метода входа -->
<input type="hidden" id="login_method" name="login_method" value="phone">
{% endblock %}

{% block additional_links %}
<a href="{% url 'auth:register' %}" class="font-medium text-blue-600 hover:text-blue-500">
    Создать аккаунт
</a>
{% endblock %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    const phoneTab = document.getElementById('phoneTab');
    const emailTab = document.getElementById('emailTab');
    const phoneLogin = document.getElementById('phoneLogin');
    const emailLogin = document.getElementById('emailLogin');
    const loginMethod = document.getElementById('login_method');

    phoneTab.addEventListener('click', function() {
        // Переключаем табы
        phoneTab.classList.add('bg-white', 'text-blue-600', 'shadow-sm');
        phoneTab.classList.remove('text-gray-500', 'hover:text-gray-700');
        emailTab.classList.remove('bg-white', 'text-blue-600', 'shadow-sm');
        emailTab.classList.add('text-gray-500', 'hover:text-gray-700');
        
        // Переключаем контент
        phoneLogin.classList.remove('hidden');
        emailLogin.classList.add('hidden');
        
        // Устанавливаем метод
        loginMethod.value = 'phone';
    });

    emailTab.addEventListener('click', function() {
        // Переключаем табы
        emailTab.classList.add('bg-white', 'text-blue-600', 'shadow-sm');
        emailTab.classList.remove('text-gray-500', 'hover:text-gray-700');
        phoneTab.classList.remove('bg-white', 'text-blue-600', 'shadow-sm');
        phoneTab.classList.add('text-gray-500', 'hover:text-gray-700');
        
        // Переключаем контент
        emailLogin.classList.remove('hidden');
        phoneLogin.classList.add('hidden');
        
        // Устанавливаем метод
        loginMethod.value = 'email';
    });

    // Валидация формы
    document.getElementById('authForm').addEventListener('submit', function(e) {
        const method = loginMethod.value;
        
        if (method === 'phone') {
            const phone = document.getElementById('phone').value;
            const smsCode = document.getElementById('sms_code').value;
            
            if (phone.length !== 10) {
                e.preventDefault();
                showNotification('Введите корректный номер телефона', 'error');
                return;
            }
            
            if (!smsCode || smsCode.length !== 6) {
                e.preventDefault();
                showNotification('Введите код подтверждения', 'error');
                return;
            }
        } else {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                e.preventDefault();
                showNotification('Заполните все поля', 'error');
                return;
            }
        }
    });
});

function togglePassword(fieldId) {
    const field = document.getElementById(fieldId);
    const icon = field.nextElementSibling.querySelector('i');
    
    if (field.type === 'password') {
        field.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
    } else {
        field.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
    }
}

function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 ${
        type === 'success' ? 'bg-green-500 text-white' : 
        type === 'error' ? 'bg-red-500 text-white' : 
        'bg-blue-500 text-white'
    }`;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.remove();
    }, 3000);
}
</script>
{% endblock %}
